- apiVersion: v1.0.0
  kind: DataProduct
  status: "active"
  name: "Data Quality Examples Product"
  id: "urn:bitol:product:data-quality-examples"
  domain: "examples"
  outputPorts:
    - name: "quality_examples_port1"
      version: "1"
      contractId: "urn:bitol:contract:data-quality-example1"
    - name: "quality_examples_port2"
      version: "1"
      contractId: "urn:bitol:contract:data-quality-example2"

- apiVersion: v3.1.0
  kind: DataContract
  id: "urn:bitol:contract:data-quality-example1"
  name: "Data Quality Examples"
  status: "active"
  version: "1.0.0"
  domain: "examples"
  schema:
    - name: quality_examples
      physicalType: table
      properties:
        - name: email_verified
          logicalType: string
          quality:
            - id: email_verified_text
              type: text
              description: The email address was verified by the system.
        
        - name: order_id
          logicalType: string
          quality:
            - id: order_id_no_nulls
              type: library
              metric: nullValues
              mustBe: 0
              unit: rows
              description: "There must be no null values in the column."
        
        - name: order_status
          logicalType: string
          quality:
            - id: order_status_null_percent
              metric: nullValues
              mustBeLessThan: 1
              unit: percent
              description: "There must be less than 1% null values in the column."

        - name: email_address
          logicalType: string
          quality:
            - id: email_missing_values
              metric: missingValues
              arguments:
                missingValues: [null, '', 'N/A', 'n/a']
              mustBeLessThan: 100
              unit: rows
            - id: email_duplicate_values
              metric: duplicateValues
              mustBeLessThan: 10
              unit: rows
              description: "There must be less than 10 duplicate values in the column."

        - name: line_item_unit
          logicalType: string
          quality:
            - id: line_item_unit_valid_values
              metric: invalidValues
              arguments:
                validValues: ['pounds', 'kg']
              mustBeLessThan: 5
              unit: rows

        - name: iban
          logicalType: string
          quality:
            - id: iban_pattern_check
              metric: invalidValues
              mustBe: 0
              description: "The value must be an IBAN."
              arguments:
                pattern: '^[A-Z]{2}[0-9]{2}[A-Z0-9]{4}[0-9]{7}([A-Z0-9]?){0,16}$'

        - name: phone_number
          logicalType: string
          quality:
            - id: phone_duplicate_percent
              metric: duplicateValues
              mustBeLessThan: 1
              unit: percent

        - name: soda_column
          logicalType: string
          quality: 
           - id: soda_duplicate_percent
             type: custom
             engine: soda
             implementation: |
               type: duplicate_percent
               # Block columns: # passed as-is
               - carrier # to the tool
               - shipment_numer # (Soda in this situation)
               must_be_less_than: 1.0 #

        - name: tenant_id
          logicalType: string
        
      quality:
        - id: orders_row_count
          metric: rowCount
          mustBeBetween: [100, 120]

        - id: orders_unique_tenant_order
          description: The combination of tenant_id and order_id must be unique
          metric: duplicateValues
          mustBe: 0
          arguments:
            properties:
              - tenant_id
              - order_id
        
        - id: sql_count_not_null
          type: sql
          query: |
            SELECT COUNT(*) FROM {object} WHERE {property} IS NOT NULL
          mustBeLessThan: 3600
        
        - id: row_count_btwn_10_50
          type: custom
          engine: greatExpectations
          implementation: |
            type: expect_table_row_count_to_be_between
            # Block kwargs: # passed as-is
            minValue: 10000 # to the tool
            maxValue: 50000 # (Great Expectations in this situation)

        - id: count_less_than_3600_scheduled
          type: sql
          query: |
            SELECT COUNT(*) FROM {object} WHERE {property} IS NOT NULL
          mustBeLessThan: 3600
          scheduler: cron
          schedule: 0 20 * * *

- apiVersion: v3.1.0
  kind: DataContract
  id: "urn:bitol:contract:data-quality-example2"
  name: "Data Quality Examples"
  status: "active"
  version: "1.0.0"
  domain: "examples"
  schema:
    - name: quality_examples
      physicalType: table
      properties:
        - name: email_verified
          logicalType: string
        - name: order_id
          logicalType: string
        - name: order_status
          logicalType: string
        - name: email_address
          logicalType: string
        - name: line_item_unit
          logicalType: string
        - name: iban
          logicalType: string
        - name: phone_number
          logicalType: string
        - name: soda_column
          logicalType: string
        - name: tenant_id
          logicalType: string